<!DOCTYPE html>
<html>
	<head>
		<title>山东大学泰山学堂计算机取向 | Computer Science Department - Taishan College - Shandong University</title>
		<meta name="description" content="山东大学泰山学堂计算机取向官方网站。Official Website for Computer Science Department of Taishan College.">
		<meta charset="utf-8">
		<meta name="viewport" content="width=1024">
		<link rel="stylesheet" type="text/css" href="css/default.css">
		<script src="js/jquery-1.11.1.min.js"></script>
		<script src="js/jquery.cookie.js"></script>
		<script>
			function renderSlide(animated_seq, content_deferred, url) {
				$.getJSON(url, function(data) {
					content_deferred.done(function() {
						for(var i = 0; i < data.length; i++) {
							$('#slide ul').append(
								'<li>' +
									'<img src="' + data[i].image + '">' +
									'<div class="mask"></div>' +
									'<div class="description">' +
										'<a href="?' + data[i].url + '">' + data[i].title + '</a>' +
										'<p>' + data[i].desc + '</p>' +
									'</div>' +
								'</li>');
						}
						$('#slide').unslider({speed: 500, delay: 4000, keys: true, dots: true, fluid: false});
						animated_seq[0].done(function() {
							$('#slide_container').bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function() {
								animated_seq[1].resolve(1);
							});
							$('#slide_container').removeClass('hidden');
						});
					});
				});
			}

			function renderColumn(content_deferred, node, lang, section, column) {
				$.getJSON('content_' + lang + '/' + section + '/' + column + '/0.json', function(data) {
					content_deferred.done(function() {
						for(var i = 0; i < (data.length > 5 ? 5 : data.length); i++) {
							$(node + ' .itemlist').append('<tr><td class="item_dot"></td><td class="item_title"><a href="' +
								((typeof data[i].url == 'string') ? data[i].url : '?s=' + section + '&amp;c=' +
								column + '&amp;a=' + data[i].url) + '">' + data[i].title + '</a></td>' + ((data[i].date) ?
								'<td class="item_date">' + data[i].date + '</td>' : '') + '</tr>');
						}
					});
				});
			}

			function getParameterByName(name) {
				name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
				var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
					results = regex.exec(location.search);
				return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
			}

			$(document).ready(function() {
				var lang = $.cookie('language');
				if(!lang) lang = 'cn';
				var animated_seq = new Array(9);
				for(var i = 0; i < 9; i++) animated_seq[i] = new $.Deferred();
				var map = $.getJSON('content_' + lang + '/map.json');
				$('#header').load('header_' + lang + '.html', function() {
					$('#header').removeClass('hidden');
					$('#footer').show();
					animated_seq[0].resolve();
					map.done(function(data) {
						renderMenu(data, section);
					});
				});
				$('#footer').load('footer_' + lang + '.html');
				var section = parseInt(getParameterByName('s'));
				if(isNaN(section)) {
					section = 0;
					var content_deferred = new $.Deferred();
					$('#content').load('index_' + lang + '.html', function() {
						content_deferred.resolve();
						Modernizr.load({
							test: Modernizr.csstransitions,
							yep : 'css/index-transition.css',
							nope: 'js/index-transition.js'
						});
						if (Modernizr.touch) {
							$('.image_popup').css('bottom', '0');
							$('.gallery_container span').css('display', 'inline');
						}
						if(!Modernizr.csstransitions) {
							$('.hidden').removeClass('hidden');
						} else {
							for(var i = 1; i < 8; i++) {
								animated_seq[i].done(function(seq) {
									$('#column' + seq + ' .col_header').bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function() {
										animated_seq[seq + 1].resolve(seq + 1);
										$('#column' + seq + ' .hidden').removeClass('hidden');
									});
									$('#column' + seq + ' .col_header').removeClass('hidden');
								});
							}
						}
					});
					renderSlide(animated_seq, content_deferred, 'content_' + lang + '/slides.json');
					renderColumn(content_deferred, '#column1', lang, 1, 3);
					renderColumn(content_deferred, '#column2', lang, 1, 2);
					renderColumn(content_deferred, '#column5', lang, 6, 1);
				} else {
					var column = parseInt(getParameterByName('c'));
					var article = parseInt(getParameterByName('a'));
					$('#content').load('content.html', function() {
						map.done(function(data) {
							renderContent(data, section, column, article, lang)
						});
					});
				}
			});

			$(window).scroll(function(e) {
				$elem = $(".floatable");
				if($(window).scrollTop() > 115) {
					if($elem.css("position") != "fixed") $elem.addClass("float");
				} else {
					if($elem.css("position") == "fixed") $elem.removeClass("float");
				}
			});
		</script>
	</head>
	<body>
		<div id="header" class="hidden"></div>
		<div id="content"></div>
		<div id="footer"></div>
	</body>
</html>
